---
title: "Bad data design leads to poor performances: from 105 minutes to 17 seconds"
date: Wed, 23 Jul 2025 18:34:38 GMT
lastUpdated: 2025-07-23T18:34:38.850Z
link: https://medium.com/@arbaudie.it/bad-data-design-leads-to-poor-performances-from-105-minutes-to-17-seconds-086a6a42beda?source=rss-c779d007e7fe------2
---

<article><div class="m"><div class="m"><span class="m"></span><section><div><div class="fw gz ha hb hc hd"></div><div class="he hf hg hh hi"><div class="ac ci"><div class="cp bi gq gr gs gt"><div><h1 class="pw-post-title hj hk hl bg hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il bl" data-testid="storyTitle" id="f803">Bad data design leads to poor performances: from 105 minutes to 17 seconds</h1><div><div class="speechify-ignore ac cw"><div class="speechify-ignore bi m"><div class="ac im in io ip iq ir is it iu iv iw"><div class="ac r iw"><div class="ac ix"><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><a data-discover="true" href="/@arbaudie.it?source=post_page---byline--086a6a42beda---------------------------------------" rel="noopener follow"><div class="m iy iz by ja jb"><div class="m fr"><img alt="ArBauDie.IT" class="m fk by bz ca de" data-testid="authorPhoto" height="32" loading="lazy" src="https://miro.medium.com/v2/resize:fill:64:64/1*kOs3AqmTfHiFOrSZkt1mqg.png" width="32"/><div class="jc by m bz ca fw o jd gk"></div></div></div></a></div></div></div></div><span class="bg b bh ab bl"><div class="je ac r"><div class="ac r jf"><div class="ac r"><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><span class="bg b bh ab bl"><a class="ah ai aj fo al am an ao ap aq ar as at jg" data-discover="true" data-testid="authorName" href="/@arbaudie.it?source=post_page---byline--086a6a42beda---------------------------------------" rel="noopener follow">ArBauDie.IT</a></span></div></div></div></div><div class="jh bn"></div></div></div></span></div><div class="ac r ji"><span class="bg b bh ab eb"><div class="ac ag"><span data-testid="storyReadTime">4 min read</span><div aria-hidden="true" class="jj jk m"><span aria-hidden="true" class="m"><span class="bg b bh ab eb">·</span></span></div><span data-testid="storyPublishDate">Jul 23, 2025</span></div></span></div></div><div class="ac cw jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka"><div class="i l x fp fq r"><div class="kq m"><div class="ac r kr ks"><div class="pw-multi-vote-icon fr kt ku kv kw"><span data-dd-action-name="Susi presentation tracker clap_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-discover="true" data-testid="headerClapButton" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F086a6a42beda&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40arbaudie.it%2Fbad-data-design-leads-to-poor-performances-from-105-minutes-to-17-seconds-086a6a42beda&amp;user=ArBauDie.IT&amp;userId=c779d007e7fe&amp;source=---header_actions--086a6a42beda---------------------clap_footer------------------" rel="noopener follow"><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><div class="kx aq ky kz la lb ao lc ld le kw" role="presentation"><svg aria-label="clap" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" fill-rule="evenodd"></path></svg></div></div></div></div></a></span></div><div class="pw-multi-vote-count m lf lg lh li lj lk ll"><p class="bg b ec ab eb"><span class="lm">--</span></p></div></div></div><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><button aria-label="responses" class="aq kx lp lq ac r fs lr ls"><svg class="lo" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bg b ec ab eb"><span class="pw-responses-count ln lo">1</span></p></button></div></div></div></div><div class="ac r kb kc kd ke kf kg kh ki kj kk kl km kn ko kp"><div class="lt l k j e"></div><div class="i l"><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><span data-dd-action-name="Susi presentation tracker bookmark_footer"><a class="ah ai aj fo al am an ao ap aq ar as at au av" data-discover="true" data-testid="headerBookmarkButton" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F086a6a42beda&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40arbaudie.it%2Fbad-data-design-leads-to-poor-performances-from-105-minutes-to-17-seconds-086a6a42beda&amp;source=---header_actions--086a6a42beda---------------------bookmark_footer------------------" rel="noopener follow"><svg aria-label="Add to list bookmark button" class="eb lu" fill="none" height="25" viewbox="0 0 25 25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z" fill="currentColor"></path></svg></a></span></div></div></div></div><div class="fk lv cu"><div class="m ag"><div class="ac ci"><div class="lw lx ly lz ma mb cp bi"><div class="ac"><div class="bn" role="tooltip"><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><button aria-label="Listen" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt" data-testid="audioPlayButton"><svg fill="none" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" fill="currentColor" fill-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Listen</p></div></button></div></div></div></div></div></div></div></div></div><div aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu" class="bn"><div><div class="bn" role="tooltip"><div class="bf" tabindex="-1"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" class="ah fs aj fo al am an mc ap aq ar fe md me ls mf mg mh mi mj t mk ml mm mn mo mp mq v mr ms mt" data-testid="headerSocialShareButton"><svg fill="none" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" fill="currentColor" fill-rule="evenodd"></path></svg><div class="k j e"><p class="bg b bh ab eb">Share</p></div></button></div></div></div></div></div></div></div></div></div></div><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="7130">I requested permission to share anonymized queries and execution plans from this case, but the client declined. So, I’ll be providing only high-level explanations and general figures in this story.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="2916">About two years ago, I had the privilege of working with a company in Northern Europe that was struggling to aggregate data from several recently acquired subsidiaries, all operating in the same industry. The core purpose of the system in question was to present a unified webui, allowing customers to track their orders and receive alerts when they were ready for pickup.<br/>The technical challenge stemmed from their data structure. They had a legacy table from their original system and a new table populated with <a class="ah ns" data-discover="true" href="/ssense-tech/event-sourcing-a-practical-guide-to-actually-getting-it-done-27d23d81de04" rel="noopener">event-sourced</a> data (yes, I know…) from the newly integrated subsidiaries. Both tables shared a similar structure and core columns.<br/>However, because order states were computed and refreshed from a message queue, things got tricky. Also customers could place an order at one subsidiary but choose to pick it up at another. This meant the system had to reconcile state and data changes across both tables to maintain consistency and accuracy.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="91cc">Given the sheer volume of data (yeah, well… event sourcing, right?) in both tables, the query — even with proper indexing — took around 1 hour and 45 minutes to execute. As a result, customers could only be alerted about order availability roughly every two hours. The client understandably wanted to tighten the update window, ideally around 15 minutes. To achieve this, they explored external tools and even considered rewriting some parts of the data pipeline. But both solutions were costly. After summarizing their options and kinda hitting a wall, they reached out to <a class="ah ns" href="https://mariadb.com" rel="noopener ugc nofollow" target="_blank">MariaDB Corporation</a> — which led to me stepping in to provide a limited-time <a class="ah ns" href="https://www.indeed.com/career-advice/finding-a-job/what-does-technical-account-manager-do" rel="noopener ugc nofollow" target="_blank">TAM (Technical Account Manager)</a> service.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="849a">We discussed the issue in depth — the background, how things had evolved to this point, and the solution they were envisioning going forward. Eventually, I got to the point of reviewing the actual query and the table structures themselves. And that’s when I stumbled upon a (very) low-hanging fruit: one of the join conditions between the two large tables involved date columns being wrapped in functions — on both sides :</p><pre class="nt nu nv nw nx ny nz oa bq ob bc bl"><span class="oc od hl nz b bh oe of m og oh" id="cef9">CAST(date_column1 AS CHAR) = STR_TO_DATE(date_column2,'%x%c%d')</span></pre><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="d4f5">As you probably (and should) know, wrapping columns in functions during joins or filters prevents indexes from being used. In this case, the functions were purely for data type manipulation — casting a DATE and an INTEGER into CHAR just to make them comparable. A quick inspection of the data types involved confirmed the OG issue:</p><pre class="nt nu nv nw nx ny nz oa bq ob bc bl"><span class="oc od hl nz b bh oe of m og oh" id="92c6">TABLE1<br/>(<br/>...<br/>date_column1 INT COMMENT 'YYYYMMDD',<br/>...);<br/><br/>TABLE2<br/>(<br/>...<br/>date_column2 DATE,<br/>...);</span></pre><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="3bff">The client was already pleased that we’d identified a potential performance gain within just a few hours on day one. Now, they were eager to see how much it could actually speed things up. So, how do we fix this — and more importantly, can we do it with minimal disruption ?</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="cc73">Long story short: yes, we can, so let’s see how.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="e4f4">Since modifying the loading software was off the table, that also meant we couldn’t touch the existing columns. Thankfully, MariaDB provides a very handy feature for situations like this: <a class="ah ns" href="https://mariadb.com/docs/server/reference/sql-statements/data-definition/create/generated-columns" rel="noopener ugc nofollow" target="_blank">generated columns</a>. A generated column is a virtual or stored column whose value is automatically calculated based on an expression involving other columns in the same table. The expression can use <a class="ah ns" href="https://mariadb.com/docs/server/reference/sql-functions" rel="noopener ugc nofollow" target="_blank">built-in functions</a> or <a class="ah ns" href="https://mariadb.com/docs/server/server-usage/user-defined-functions" rel="noopener ugc nofollow" target="_blank">UDFs (user-defined functions)</a> (<a class="ah ns" data-discover="true" href="/@arbaudie.it/mariadb-extensibility-dce50baece54" rel="noopener">remember that time when i displayed how powerful UDFs can be</a>).</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="b755">So the real question became:<br/> Do we create a generated column in one of the tables? Or in both?</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="6362">Since we’re aiming for performance, and INTEGER is the fastest data type, we’ll lean into that. Let’s generate a clean, indexed integer value to join on — and keep everything else as it is.</p><pre class="nt nu nv nw nx ny nz oa bq ob bc bl"><span class="oc od hl nz b bh oe of m og oh" id="d818">ALTER TABLE TABLE2 ADD date_column2_as_int INT AS CAST(DATE_FORMAT(date_column2, '%Y%m%d') AS UNSIGNED) VIRTUAL COMMENT 'YYYYMMDD - for index+join purposes';</span></pre><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="48a0">Now that we have our integer column available on both sides, we can update the join condition in the query to use them directly, as follows:</p><pre class="nt nu nv nw nx ny nz oa bq ob bc bl"><span class="oc od hl nz b bh oe of m og oh" id="41bc">date_column1 = date_column2_as_int</span></pre><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="a0d5">Also, to maximize the performance benefits of the new generated column, let’s create an index that mimic the existing one, but replace the plain date column with the generated column:</p><pre class="nt nu nv nw nx ny nz oa bq ob bc bl"><span class="oc od hl nz b bh oe of m og oh" id="8fc2">CREATE INDEX idx_match ON TABLE2( ..., date_column2_as_int);</span></pre><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="4db5">After setting up a test environment with the latest production backup, the results were stunning: according to the explain plan, the new indexes were used, and the query now runs in 17 seconds.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="a653"><strong class="mw hm">17 SECONDS — HOLY *****!!!</strong></p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="e34e">I knew it would be faster by a solid margin, but wow… just wow.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="6934">To wrap it up, this perfectly illustrates the two key lessons I always share with my performance tuning trainees. First, databases are like buildings — none is stronger/faster than its foundations. Second, data design is the foundation of any database, so invest time and brainpower into it.<strong class="mw hm"><br/></strong>And remember: data design is mostly database engine–independent.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="9adf">In today’s case, we relied on MariaDB-specific features like generated columns to <em class="oi">emulate</em> good data design, because rebuilding from scratch wasn’t an option. But in an ideal world, both tables would have had aligned design, so data types in our case, from the start — and the performance would have been there from the get-go.</p><p class="pw-post-body-paragraph mu mv hl mw b mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr he bl" id="68ad">Now tell me, who would not like to benefit from such feats and knowledge ? <a class="ah ns" href="https://arbaudie.it/" rel="noopener ugc nofollow" target="_blank">Reach out to me</a> and le’ts see what you need and how i can help you solve those pain points of yours !!</p></div></div></div></div></section></div></div></article>
