---
title: "InnoDB deep dive : commit phase"
date: Mon, 24 Feb 2025 14:33:23 GMT
lastUpdated: 2025-02-24T14:33:23.441Z
link: https://medium.com/@arbaudie.it/innodb-deep-dive-commit-phase-20e9022e98d5?source=rss-c779d007e7fe------2
---

<h3>InnoDB deep dive : commit phase</h3><p>Every time you <a href="https://hackmysql.com/group-commit-and-trx-dependency-tracking">COMMIT</a> a statement in InnoDB, a carefully orchestrated sequence of events takes place to ensure your data remains safe and consistent. Understanding how InnoDB handles transaction commits is crucial for anyone serious about database reliability and performance. The key to this process lies in a misunderstood configuration parameter: <a href="https://mariadb.com/kb/en/innodb-system-variables/#innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a>.</p><p>When a transaction commits in InnoDB, changes are first recorded in the redo log — a set of files and memory buffers that ensures durability of your data even in case of crash. How these changes make their way from memory to disk is controlled by the innodb_flush_log_at_trx_commit setting, which directly impacts both your database’s <a href="https://en.wikipedia.org/wiki/ACID">ACID</a> compliance and write performance. It determines whether your transactions are immediately written to disk, buffered in memory, or something in between through three possible values : 0, 1 or 2.</p><p>Let’s break down each setting value and its implications.</p><p>With innodb_flush_log_at_trx_commit set to 1, every transaction commit triggers an immediate flush to disk and a fsync() call. This means your data is safe even in the event of a complete system failure, making it the only setting that guarantees true ACID compliance. However, this safety comes at the cost of increased I/O operations and potential performance impact, especially in write-heavy workloads.</p><p>Setting the value to 0 prioritizes performance over durability. In this mode, InnoDB writes to the log buffer and only flushes to disk once per second. While this can significantly improve transaction throughput, it means you could lose up to a second’s worth of transactions in the event of a system crash. This setting might be acceptable for applications where data loss of a few seconds is tolerable, such as session management or cached data.</p><p>The middle ground is setting innodb_flush_log_at_trx_commit to 2. Here, InnoDB writes to the operating system cache at commit time, with actual disk flushes happening once per second. This provides better durability than setting 0 while offering better performance than setting 1. However, it’s important to note that you’re still vulnerable to data loss in case of operating system crashes or power failures.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/948/1*utaf_GgXp4UNHk31SEZdIg.png" /></figure><p>Choosing the right setting isn’t just about understanding these technical details — it’s about balancing your <a href="https://www.percona.com/blog/maximal-write-througput-in-mysql/">specific requirements for durability, performance, and compliance</a>. If durability is paramount over write performance should stick with the default value of 1. If not, like in a <a href="https://galeracluster.com/">Galera cluster</a> where <a href="https://en.wikipedia.org/wiki/ACID#Durability">durability</a> is achieved over the cluster as a whole, then your system might benefit from the performance gains of settings 2.</p><p>Remember that these settings don’t exist in isolation. They interact with other InnoDB configurations like <a href="https://mariadb.com/kb/en/innodb-system-variables/#innodb_flush_method">innodb_flush_method</a> and <a href="https://mariadb.com/kb/en/innodb-system-variables/#innodb_log_buffer_size">innodb_log_buffer_size</a>, and <a href="https://linuxblog.io/innodb_flush_method-innodb_flush_log_at_trx_commit-optimizing-mysql/">their impact</a> can be influenced by your hardware configuration, especially your storage subsystem. Modern solutions like <a href="https://hackmysql.com/group-commit-and-trx-dependency-tracking">group commit</a> can help mitigate some of the performance impact of setting 1, making it more viable even in high-throughput scenarios.</p><img alt="" height="1" src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=20e9022e98d5" width="1" />
